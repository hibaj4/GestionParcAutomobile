<SfDialog Width="280px" IsModal="true" ShowCloseIcon="true" @bind-Visible="IsVisible">
    <DialogEvents OnOpen="OpenDialog"></DialogEvents>
    <DialogTemplates>
        <Header>@Title Trajet</Header>
        <Content>
            <EditForm Model="Trajet" Enhance OnSubmit="Save">
                <div class="card border-success">
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Id</label>
                            <input @bind="Trajet.Id" class="form-control" disabled />
                        </div>


                          <div class="form-group">
    <label class="form-label">Date</label>
    <input type="datetime-local"
           class="form-control"
           @bind="Trajet.Date" />
</div>
                      
                        <div class="form-group">
                            <label class="form-label">Départ</label>
                            <InputText @bind-Value="Trajet.LieuDepart" class="form-control" />
                        </div>
                        <div class="form-group">
                            <label class="form-label">Destination</label>
                            <InputText @bind-Value="Trajet.Destination" class="form-control" />
                        </div>
                         <div class="form-check form-switch mb-3">
                        <InputCheckbox @bind-Value="Trajet.IsMission" class="form-check-input" />
                        <label class="form-check-label">Mission</label>
                    </div>
                        <div class="form-group">
                            <label class="form-label">Distance parcourue (km)</label>
                            <InputNumber @bind-Value="Trajet.DistanceParcourue" class="form-control" />
                        </div>

                        <div class="form-group mt-3 mb-3">
                            <label class="form-label">Sélectionner CIN</label>
                           

                            @if (Trajet.Utilisateur != null)
    {
        string selected = Trajet.Utilisateur!.CIN!;
        <SfDropDownList TValue="string" TItem="Utilisateur" Placeholder="@selected" DataSource="Utilisateurs">
            <DropDownListFieldSettings Value="Id" Text="CIN"></DropDownListFieldSettings>

            <DropDownListEvents TValue="string" TItem="Utilisateur" ValueChange="OnUtilisateurChange"></DropDownListEvents>

        </SfDropDownList>

    }
    else
    {
        <SfDropDownList TValue="string" TItem="Utilisateur" Placeholder="Select Utilisateur" DataSource="Utilisateurs">
            <DropDownListFieldSettings Value="Id" Text="CIN"></DropDownListFieldSettings>

            <DropDownListEvents TValue="string" TItem="Utilisateur" ValueChange="OnUtilisateurChange"></DropDownListEvents>

        </SfDropDownList>
    }
                        </div>
                    </div>
                </div>
            </EditForm>
        </Content>
    </DialogTemplates>

    <DialogButtons>
        <DialogButton Content="Enregistrer" Type="ButtonType.Submit" IsPrimary="true" OnClick="Save" />
    </DialogButtons>
</SfDialog>

@code {
    [Parameter] public Trajet Trajet { get; set; } = new();
    [Parameter] public List<Utilisateur> Utilisateurs { get; set; } = new();
    [Parameter] public List<Voiture> Voitures { get; set; } = new();
    [Parameter] public EventCallback<Trajet> HandleSaveOperationEvent { get; set; }

    private bool IsVisible { get; set; } = false;
    public string Title { get; set; } = "Ajouter";

    private async void Save()
    {
        if (Trajet.UtilisateurId <= 0)
        {
            await dialogService.AlertAsync("Inexistant", "Alerte !");
        }
        else
        {
            await HandleSaveOperationEvent.InvokeAsync(Trajet);
        }
    }

    public void OpenDialog()
    {
        IsVisible = true;
        StateHasChanged();
    }

    public void ChangeTitle(string title)
    {
        Title = title;
    }

    public void OnUtilisateurChange(ChangeEventArgs<string, Utilisateur> args)
    {
        Trajet.UtilisateurId = int.Parse(args.Value);
    }
}
